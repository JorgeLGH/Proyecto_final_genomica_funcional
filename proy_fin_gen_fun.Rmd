---
title: "Proyecto final Genómica Funcional"
author: "Gómez Hernández Jorge Luis, Rojas García Luis Andrés"
date: "5/28/2021"
output: 
  html_document: 
    theme: cerulean
---


Primero, señalamos el directorio de trabajo donde se va a llevar todo a cabo y cargamos la librería principal que se usará.
```{r}
setwd("~/R/Genomica_funcional/pro_fin_genfun/") #cambiar para PROPIO directorio de trabajo
library(dada2)
```
Ahora se define la ruta en la cual están los archivos FASTQ que se usarán
```{r}
ruta<-"~/R/Genomica_funcional/pro_fin_genfun/fastq_pro_fin_suelo/" #debe de cambiarse segpun el usuario y su localización de sus archivos
head(list.files(ruta)) #manda los nombres de todos los archivos que hay en esa ruta
```
El siguiente paso es definir qué secuencias son las reverse y las forward, esto porque el experimento cuenta con secuencias pareadas. En este caso particular, los archivos con *_1* son la secuencia *forward*, mientras que los archivos con *_2* son las secuencias *reverse*.
```{r}
#estas líneas dividen los 
forward<-sort(list.files(ruta, pattern="_1.fastq", full.names = TRUE))
reverse<-sort(list.files(ruta, pattern="_2.fastq", full.names = TRUE))
sample.names <- sapply(strsplit(basename(forward), "_"), `[`, 1) #con esta línea tenemos los nombres de las muestras sin la clasificación de forward y reverse. Separa y selecciona según la función sapply, tomamos el primer fragmento de la separación
```
# Calidad Phred
En esta parte se usará la calidad Phred para poder realizar, mas adelante, los cortes en los reads según lo que se pueda observar con las gráficas que se basan en este índice de calidad de los reads.
```{r}
#visualización de la calidad de Phred de las tres primeras secuencias tanto de forward como de reverse
plotQualityProfile(forward[1:3])
plotQualityProfile(reverse[1:3])
```
#Filtrado y trimming de los reads
En esta parte se hace el filtrado de los reads con los cortes arbitrarios basados con la visualización de la calidad Phred.
```{r}
# Colocar los archivos en un archivo llamado filtered y que contenga los forward y reverse compresos en gz
filtFs <- file.path(ruta, "filtered", paste0(sample.names, "_F_filt.fastq.gz"))
filtRs <- file.path(ruta, "filtered", paste0(sample.names, "_R_filt.fastq.gz"))
#asignamos los nombres a los archivos filtrados
names(filtFs) <- sample.names
names(filtRs) <- sample.names
```
Ahora ya sigue el corte y la formación de los archivos filtrados.
```{r}
#aquí se genera el archivo como tal, cada uno de los archivos "filtered" de la parte anterior ahora existe con la información obtenida aquí, ya son las secuencias filtradas con los cortes arbitrarios que se desearon.
out <- filterAndTrim(forward, filtFs, reverse, filtRs, truncLen=c(200,140),
              maxN=0, maxEE=c(2,2), truncQ=2, rm.phix=TRUE, 
              compress=TRUE, multithread=F)
head(out)
```

